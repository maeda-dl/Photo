<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚ã¿ã ãã˜</title>
<style>
  body { font-family:sans-serif; text-align:center; padding:10px; }
  .member { width:60px; height:60px; border:2px solid #aaa; border-radius:8px; cursor:pointer; display:inline-block; margin:5px; }
  .slot { width:70px; height:90px; border:2px dashed #aaa; display:inline-flex; align-items:center; justify-content:center; margin:5px; cursor:pointer; }
</style>
</head>
<body>

<h1>ã‚ã¿ã ãã˜ ğŸ²</h1>

<p>ğŸ“· ã‚«ãƒ¡ãƒ©<input type="file" id="cameraUpload" accept="image/*" capture="environment" multiple></p>
<p>ğŸ–¼ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ<input type="file" id="fileUpload" accept="image/*" multiple></p>

<div id="members-container"></div>

<h2>ã‚¹ãƒ­ãƒƒãƒˆã«é…ç½®</h2>
<div id="slots-container">
  <div class="slot">Slot 1</div>
  <div class="slot">Slot 2</div>
  <div class="slot">Slot 3</div>
  <div class="slot">Slot 4</div>
  <div class="slot">Slot 5</div>
</div>

<button id="start-button">ã‚ã¿ã ãã˜é–‹å§‹ï¼</button>
<div id="result"></div>

<script>
let members = [];
let selectedImage = null;

function handleFiles(files){
  const arr = Array.from(files).slice(0,5-members.length);
  arr.forEach(file=>{
    const reader = new FileReader();
    reader.onload = ()=>{
      const div = document.createElement("div");
      div.className="member";
      div.innerHTML=`<img src="${reader.result}" width="100%" height="100%">`;
      div.onclick=()=>{ document.querySelectorAll(".member").forEach(m=>m.style.borderColor="#aaa"); div.style.borderColor="red"; selectedImage=reader.result; };
      document.getElementById("members-container").appendChild(div);
      members.push(reader.result);
    };
    reader.readAsDataURL(file);
  });
}

document.getElementById("cameraUpload").addEventListener("change",e=>{handleFiles(e.target.files); e.target.value="";});
document.getElementById("fileUpload").addEventListener("change",e=>{handleFiles(e.target.files); e.target.value="";});

// ã‚¹ãƒ­ãƒƒãƒˆã«é…ç½®
document.querySelectorAll(".slot").forEach(slot=>{
  slot.addEventListener("click", ()=>{
    if(!selectedImage){ alert("ç”»åƒã‚’é¸ã‚“ã§ãã ã•ã„"); return; }
    slot.innerHTML=`<img src="${selectedImage}" style="width:100%;height:100%;">`;
  });
});

// ã‚ã¿ã ãã˜é–‹å§‹
document.getElementById("start-button").addEventListener("click", ()=>{
  const assigned=[];
  document.querySelectorAll(".slot").forEach(slot=>{
    const img = slot.querySelector("img");
    if(img) assigned.push({image:img.src});
  });
  if(assigned.length!==5){ alert("5ã¤ã™ã¹ã¦ã®ã‚¹ãƒ­ãƒƒãƒˆã«é…ç½®ã—ã¦ãã ã•ã„"); return; }

  const prizes = ["ğŸ ã‚Šã‚“ã”","ğŸ ã‚®ãƒ•ãƒˆåˆ¸","ğŸ« ãƒãƒ§ã‚³","â˜• ã‚³ãƒ¼ãƒ’ãƒ¼","ğŸ‰ ã‚µãƒ—ãƒ©ã‚¤ã‚ºï¼"];
  const shuffled = prizes.sort(()=>Math.random()-0.5);

  let output="<h3>çµæœç™ºè¡¨ ğŸ‰</h3><ul>";
  const results = [];
  assigned.forEach((a,i)=>{
    results.push({image:a.image, prize:shuffled[i]});
    output+=`<li><img src="${a.image}" width="24" height="24"> â†’ ${shuffled[i]}</li>`;
  });
  output+="</ul>";
  document.getElementById("result").innerHTML=output;

fetch("https://script.google.com/macros/s/AKfycbyOwcJzPJsg6mZ3fyQ803RNMgO8t5tZ3CcUJG69aFgbqA7BVRkRfpx6YYxG4YR8moO2-A/exec", {
  method: "POST",
  body: JSON.stringify({results}),
  headers: {"Content-Type":"application/json"}
})
.then(res => res.text())
.then(msg => {
  document.getElementById("result").innerHTML += `<p>${msg}</p>`;
})
.catch(err => {
  document.getElementById("result").innerHTML += `<p style="color:red;">ã‚¨ãƒ©ãƒ¼: ${err}</p>`;
});

});
</script>

</body>
</html>
